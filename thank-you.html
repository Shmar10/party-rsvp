<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thank You! | Party RSVP</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        .thank-you-container {
            text-align: center;
            padding: 60px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .emoji {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .thank-you-message {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .thank-you-text {
            font-size: 18px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .event-reminder {
            background: rgba(102, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: left;
        }

        .back-btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            transition: transform 0.2s;
        }

        .back-btn:hover {
            transform: scale(1.05);
        }

        .calendar-btn {
            display: inline-block;
            padding: 12px 30px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 30px;
            transition: transform 0.2s;
            margin: 10px;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }

        .calendar-btn:hover {
            transform: scale(1.05);
            background: #218838;
        }

        .btn-container {
            margin-top: 20px;
        }
    </style>
</head>

<body class="dark-mode">
    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <main class="container thank-you-container" data-event-name="" data-event-date="" data-event-time=""
        data-event-location="">
        <div class="emoji" id="emoji">üéâ</div>
        <h1 class="thank-you-message" id="message">Thank You!</h1>
        <p class="thank-you-text" id="text"></p>

        <div class="event-reminder" id="reminder" style="display: none;">
            <h3 style="margin-top: 0; color: #667eea;">Event Details:</h3>
            <p style="margin: 10px 0;"><strong>üìÖ Date:</strong> <span id="detailDate">Saturday, Jan 24th</span></p>
            <p style="margin: 10px 0;"><strong>‚è∞ Time:</strong> <span id="detailTime">6:00 PM</span></p>
            <p style="margin: 10px 0;"><strong>üìç Location:</strong> <span id="detailLocation">The Martin's Lanai</span>
            </p>
        </div>

        <div class="btn-container">
            <button class="calendar-btn" id="addToCalendarBtn" style="display: none;" onclick="addToCalendar()">
                üìÖ Add to Calendar
            </button>
            <br>
            <a href="index.html" class="back-btn">‚Üê Back to Home</a>
        </div>
    </main>

    <script>
        // Get attending status and event details from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const attending = urlParams.get('attending');
        const eventName = urlParams.get('event') || 'Party Event';
        const eventDate = urlParams.get('date') || 'Saturday, Jan 24th';
        const eventTime = urlParams.get('time') || '6:00 PM';
        const eventLocation = urlParams.get('location') || 'TBD';

        const emojiEl = document.getElementById('emoji');
        const messageEl = document.getElementById('message');
        const textEl = document.getElementById('text');
        const reminderEl = document.getElementById('reminder');
        const addCalendarBtn = document.getElementById('addToCalendarBtn');

        // Store event details in data attributes
        const mainEl = document.querySelector('.thank-you-container');
        mainEl.setAttribute('data-event-name', eventName);
        mainEl.setAttribute('data-event-date', eventDate);
        mainEl.setAttribute('data-event-time', eventTime);
        mainEl.setAttribute('data-event-location', eventLocation);

        if (attending === 'yes') {
            emojiEl.textContent = 'üéâ';
            messageEl.textContent = "We Can't Wait to See You!";
            textEl.textContent = "Your RSVP has been received. We're so excited you can make it! Get ready for an unforgettable evening of great music, drinks, and amazing company.";
            reminderEl.style.display = 'block';
            addCalendarBtn.style.display = 'inline-block';

            // Update detail display
            document.getElementById('detailDate').textContent = eventDate;
            document.getElementById('detailTime').textContent = eventTime;
            document.getElementById('detailLocation').textContent = eventLocation;
        } else if (attending === 'no') {
            emojiEl.textContent = 'üò¢';
            messageEl.textContent = "We'll Miss You!";
            textEl.textContent = "Thank you for letting us know. We're sorry you can't make it, but we hope to see you at the next celebration!";
        } else {
            // Default message if no parameter
            messageEl.textContent = "Thank You!";
            textEl.textContent = "Your RSVP has been received.";
        }

        function addToCalendar() {
            const name = mainEl.getAttribute('data-event-name');
            const date = mainEl.getAttribute('data-event-date');
            const time = mainEl.getAttribute('data-event-time');
            const location = mainEl.getAttribute('data-event-location');

            // Parse date and time (this is a simplified parser - adjust as needed)
            // For now, we'll use a fixed date format
            // You can enhance this to parse various formats
            const eventDateTime = parseEventDateTime(date, time);

            // Generate .ics file content
            const icsContent = generateICS(name, eventDateTime, location);

            // Create download link
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'event.ics';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function parseEventDateTime(dateStr, timeStr) {
            // Simple parser - enhance as needed
            // For now, returns a default date
            // In production, you'd want to parse the actual date/time strings
            const now = new Date();
            const year = now.getFullYear();

            // Try to extract month and day from dateStr
            // This is a simple implementation
            const month = dateStr.includes('Jan') ? 0 :
                dateStr.includes('Feb') ? 1 :
                    dateStr.includes('Mar') ? 2 :
                        dateStr.includes('Apr') ? 3 :
                            dateStr.includes('May') ? 4 :
                                dateStr.includes('Jun') ? 5 :
                                    dateStr.includes('Jul') ? 6 :
                                        dateStr.includes('Aug') ? 7 :
                                            dateStr.includes('Sep') ? 8 :
                                                dateStr.includes('Oct') ? 9 :
                                                    dateStr.includes('Nov') ? 10 : 11;

            const dayMatch = dateStr.match(/\d+/);
            const day = dayMatch ? parseInt(dayMatch[0]) : 1;

            // Parse time
            const hourMatch = timeStr.match(/(\d+):?(\d*)\s*(AM|PM)/i);
            let hour = 18; // default 6 PM
            let minute = 0;

            if (hourMatch) {
                hour = parseInt(hourMatch[1]);
                minute = hourMatch[2] ? parseInt(hourMatch[2]) : 0;
                if (hourMatch[3].toUpperCase() === 'PM' && hour < 12) hour += 12;
                if (hourMatch[3].toUpperCase() === 'AM' && hour === 12) hour = 0;
            }

            return new Date(year, month, day, hour, minute);
        }

        function generateICS(title, startDate, location) {
            const endDate = new Date(startDate.getTime() + (3 * 60 * 60 * 1000)); // 3 hours duration

            const formatDate = (date) => {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };

            const now = new Date();
            const dtstamp = formatDate(now);
            const dtstart = formatDate(startDate);
            const dtend = formatDate(endDate);

            return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Party RSVP//Event//EN
BEGIN:VEVENT
UID:${dtstamp}@partyrsvp
DTSTAMP:${dtstamp}
DTSTART:${dtstart}
DTEND:${dtend}
SUMMARY:${title}
LOCATION:${location}
DESCRIPTION:${title} - See you there!
STATUS:CONFIRMED
END:VEVENT
END:VCALENDAR`;
        }
    </script>
</body>

</html>